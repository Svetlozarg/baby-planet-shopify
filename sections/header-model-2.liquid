{% comment %}
  Enhanced Header Model 2 - Modern icon-based header actions
  Features: Responsive search, user dropdown, wishlist, cart with improved mobile UX
{% endcomment %}

<style>
  /* Enhanced Header Model 2 Icons */
  .header-model-2-icons {
    list-style: none;
    margin: 0;
    padding: 0;
    display: flex;
    align-items: center;
    justify-content: flex-end;
    gap: 8px;
    position: relative;
  }

  .header-model-2-icons li {
    position: relative;
    flex-shrink: 0;
  }

  .header-model-2-icons .header-icon-btn {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 40px;
    height: 40px;
    background: transparent;
    color: #7b6b8a;
    border: none;
    text-decoration: none;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    font-size: 18px;
    cursor: pointer;
    position: relative;
    border-radius: 0;
    box-shadow: none;
  }

  .header-model-2-icons .header-icon-btn:hover {
    color: #ff6b9d;
    background: none;
    transform: none;
  }

  .header-model-2-icons .header-icon-btn:focus,
  .header-model-2-icons .header-icon-btn:active,
  .header-model-2-icons .header-icon-btn:focus-visible {
    outline: none !important;
    color: #ff6b9d;
    background: none !important;
    box-shadow: none !important;
    border: none !important;
  }

  /* Clean Search Dropdown */
  .header-model-2-icons .search-form {
    position: absolute;
    top: calc(100% + 15px);
    right: 0;
    background: #ffffff;
    border: 1px solid #e8e1ec;
    border-radius: 16px;
    padding: 25px;
    min-width: 380px;
    max-width: 420px;
    box-shadow: 0 12px 40px rgba(123, 107, 138, 0.12);
    z-index: 1000;
    display: none;
    animation: searchDropdownIn 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    backdrop-filter: blur(10px);
  }

  @keyframes searchDropdownIn {
    0% {
      opacity: 0;
      transform: translateY(-10px) scale(0.95);
    }
    100% {
      opacity: 1;
      transform: translateY(0) scale(1);
    }
  }

  .header-model-2-icons .search-form.active {
    display: block;
  }

  .header-model-2-icons .search-form::before {
    content: '';
    position: absolute;
    top: -8px;
    right: 30px;
    width: 0;
    height: 0;
    border-left: 8px solid transparent;
    border-right: 8px solid transparent;
    border-bottom: 8px solid #e8e1ec;
    z-index: 1;
  }

  .header-model-2-icons .search-form::after {
    content: '';
    position: absolute;
    top: -7px;
    right: 31px;
    width: 0;
    height: 0;
    border-left: 7px solid transparent;
    border-right: 7px solid transparent;
    border-bottom: 7px solid #ffffff;
    z-index: 2;
  }

  .header-model-2-icons .search-form h4 {
    margin: 0 0 20px 0;
    color: #7b6b8a;
    font-size: 16px;
    font-weight: 600;
    text-align: center;
    letter-spacing: 0.02em;
  }

  .header-model-2-icons .search-form .search-input-wrapper {
    position: relative;
    display: flex;
    align-items: center;
    background: #fafbff;
    border: 1px solid #f0e8f3;
    border-radius: 25px;
    overflow: hidden;
    transition: all 0.3s ease;
  }

  .header-model-2-icons .search-form .search-input-wrapper:focus-within {
    border-color: #ff6b9d;
    background: #ffffff;
    box-shadow: 0 0 0 3px rgba(255, 107, 157, 0.08);
  }

  .header-model-2-icons .search-form .search-icon {
    position: absolute;
    left: 18px;
    color: #b8a8c8;
    font-size: 16px;
    pointer-events: none;
    transition: all 0.3s ease;
    z-index: 1;
  }

  .header-model-2-icons .search-form .search-input-wrapper:focus-within .search-icon {
    color: #ff6b9d;
  }

  .header-model-2-icons .search-form input {
    flex: 1;
    padding: 16px 18px 16px 50px;
    border: none;
    background: transparent;
    font-size: 15px;
    color: #5a4b6b;
    outline: none;
    font-family: inherit;
    font-weight: 500;
  }

  .header-model-2-icons .search-form input::placeholder {
    color: #a094b7;
    font-weight: 400;
  }

  .header-model-2-icons .search-form button {
    background: linear-gradient(135deg, #ff6b9d 0%, #ffa8cc 100%);
    color: #ffffff;
    border: none;
    padding: 16px 24px;
    font-size: 14px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    border-radius: 0 25px 25px 0;
    margin: 0;
    flex-shrink: 0;
  }

  .header-model-2-icons .search-form button:hover {
    background: linear-gradient(135deg, #ff4d8a 0%, #ff87b3 100%);
    transform: translateX(-2px);
  }

  .header-model-2-icons .close-search {
    position: absolute;
    top: 20px;
    right: 20px;
    background: #f8f5fa;
    border: 1px solid #f0e8f3;
    color: #7b6b8a;
    font-size: 16px;
    cursor: pointer;
    padding: 8px;
    border-radius: 12px;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    width: 36px;
    height: 36px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 600;
  }

  .header-model-2-icons .close-search:hover,
  .header-model-2-icons .close-search:focus,
  .header-model-2-icons .close-search:active {
    background: #ff6b9d;
    color: #ffffff;
    border-color: #ff6b9d;
    transform: scale(1.05);
    outline: none !important;
    box-shadow: 0 4px 15px rgba(255, 107, 157, 0.3) !important;
  }

  /* User Dropdown */
  .header-model-2-icons .user-dropdown {
    position: absolute;
    top: calc(100% + 15px);
    right: 0;
    background: linear-gradient(135deg, #fff 0%, #fef9ff 100%);
    border: 2px solid #e8e1ec;
    border-radius: 16px;
    padding: 25px 0;
    min-width: 240px;
    box-shadow: 0 15px 40px rgba(123, 107, 138, 0.2);
    z-index: 1000;
    display: none;
    animation: slideDown 0.4s ease-out;
    backdrop-filter: blur(10px);
  }

  .header-model-2-icons .user-dropdown.active {
    display: block;
  }

  .header-model-2-icons .user-dropdown::before {
    content: '';
    position: absolute;
    top: -10px;
    right: 30px;
    width: 0;
    height: 0;
    border-left: 10px solid transparent;
    border-right: 10px solid transparent;
    border-bottom: 10px solid #e8e1ec;
  }

  .header-model-2-icons .user-dropdown::after {
    content: '';
    position: absolute;
    top: -8px;
    right: 32px;
    width: 0;
    height: 0;
    border-left: 8px solid transparent;
    border-right: 8px solid transparent;
    border-bottom: 8px solid #fff;
  }

  .header-model-2-icons .user-dropdown h4 {
    margin: 0 0 20px 0;
    padding: 0 25px;
    color: #7b6b8a;
    font-size: 16px;
    font-weight: 600;
    text-align: center;
    border-bottom: 1px solid #f0e8f3;
    padding-bottom: 15px;
  }

  .header-model-2-icons .user-dropdown ul {
    list-style: none;
    margin: 0;
    padding: 0;
  }

  .header-model-2-icons .user-dropdown li {
    margin: 0;
  }

  .header-model-2-icons .user-dropdown a {
    display: flex;
    align-items: center;
    padding: 12px 25px;
    color: #7b6b8a;
    text-decoration: none;
    transition: all 0.3s ease;
    font-size: 14px;
    font-weight: 500;
    position: relative;
    overflow: hidden;
  }

  .header-model-2-icons .user-dropdown a::before {
    content: '';
    position: absolute;
    left: 0;
    top: 0;
    width: 0;
    height: 100%;
    background: linear-gradient(90deg, #ffeef0 0%, transparent 100%);
    transition: width 0.3s ease;
    z-index: -1;
  }

  .header-model-2-icons .user-dropdown a:hover::before {
    width: 0%;
  }

  .header-model-2-icons .user-dropdown a:hover,
  .header-model-2-icons .user-dropdown a:focus,
  .header-model-2-icons .user-dropdown a:active {
    color: #ff6b9d;
    padding-left: 25px;
    background: none !important;
    outline: none !important;
    box-shadow: none !important;
    border: none !important;
  }

  .header-model-2-icons .user-dropdown i {
    margin-right: 12px;
    width: 18px;
    color: #b8a8c8;
    font-size: 14px;
    transition: color 0.3s ease;
  }

  .header-model-2-icons .user-dropdown a:hover i {
    color: #ff6b9d;
  }

  /* Cart Count Badge */
  .header-model-2-icons .cart-count {
    position: absolute;
    top: -8px;
    right: -8px;
    background: linear-gradient(135deg, #ff6b9d 0%, #ffa8cc 100%);
    color: #ffffff;
    border-radius: 50%;
    width: 20px;
    height: 20px;
    font-size: 11px;
    font-weight: 700;
    display: flex;
    align-items: center;
    justify-content: center;
    line-height: 1;
    border: 2px solid #ffffff;
    box-shadow: 0 2px 8px rgba(255, 107, 157, 0.3);
  }

  /* Desktop Responsive */
  @media (max-width: 1199px) {
    .header-model-2-icons {
      gap: 6px;
    }

    .header-model-2-icons .header-icon-btn {
      width: 38px;
      height: 38px;
      font-size: 16px;
    }

    .header-model-2-icons .search-form {
      min-width: 340px;
      max-width: 380px;
      right: -10px;
      padding: 20px;
    }

    .header-model-2-icons .search-form h4 {
      font-size: 15px;
      margin-bottom: 15px;
    }

    .header-model-2-icons .search-form input {
      padding: 14px 16px 14px 45px;
      font-size: 14px;
    }

    .header-model-2-icons .search-form .search-icon {
      left: 16px;
      font-size: 14px;
    }

    .header-model-2-icons .search-form button {
      padding: 14px 20px;
      font-size: 13px;
    }

    .header-model-2-icons .user-dropdown {
      min-width: 220px;
      right: -10px;
    }
  }

  /* Tablet Responsive */
  @media (max-width: 967px) {
    .header-model-2-icons .search-toggle,
    .header-model-2-icons .wishlist-toggle,
    .header-model-2-icons .user-toggle {
      display: none !important;
    }

    .header-model-2-icons {
      gap: 6px;
    }

    .header-model-2-icons .header-icon-btn {
      width: 40px;
      height: 40px;
      font-size: 17px;
    }

    .header-model-2-icons .cart-count {
      width: 18px;
      height: 18px;
      font-size: 10px;
      top: -6px;
      right: -6px;
    }
  }

  /* Mobile Responsive */
  @media (max-width: 767px) {
    .header-model-2-icons {
      gap: 4px;
    }

    .header-model-2-icons .header-icon-btn {
      width: 38px;
      height: 38px;
      font-size: 16px;
    }

    .header-model-2-icons .search-form {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(255, 255, 255, 0.98);
      border: none;
      border-radius: 0;
      min-width: auto;
      max-width: none;
      padding: 80px 20px 20px;
      backdrop-filter: blur(10px);
      z-index: 10001;
      animation: mobileSlideIn 0.3s ease-out;
    }

    .header-model-2-icons .search-form::before,
    .header-model-2-icons .search-form::after {
      display: none;
    }

    .header-model-2-icons .search-form h4 {
      font-size: 18px;
      margin-bottom: 25px;
    }

    .header-model-2-icons .search-form input {
      padding: 18px 20px 18px 55px;
      font-size: 16px;
    }

    .header-model-2-icons .search-form .search-icon {
      left: 20px;
      font-size: 16px;
    }

    .header-model-2-icons .search-form button {
      padding: 18px 25px;
      font-size: 14px;
    }

    .header-model-2-icons .user-dropdown {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(255, 255, 255, 0.98);
      border: none;
      border-radius: 0;
      min-width: auto;
      padding: 70px 15px 15px;
      backdrop-filter: blur(10px);
      z-index: 10001;
      animation: mobileSlideIn 0.3s ease-out;
    }

    .header-model-2-icons .user-dropdown::before,
    .header-model-2-icons .user-dropdown::after {
      display: none;
    }

    .header-model-2-icons .user-dropdown h4 {
      font-size: 20px;
      margin-bottom: 30px;
    }

    .header-model-2-icons .cart-count {
      width: 16px;
      height: 16px;
      font-size: 9px;
    }
  }

  @keyframes mobileSlideIn {
    from {
      opacity: 0;
      transform: scale(0.9);
    }
    to {
      opacity: 1;
      transform: scale(1);
    }
  }

  /* Focus States for Accessibility - Clean */
  .header-model-2-icons .header-icon-btn:focus,
  .header-model-2-icons .header-icon-btn:active,
  .header-model-2-icons .header-icon-btn:focus-visible {
    outline: none !important;
    box-shadow: none !important;
    background: none !important;
    border: none !important;
  }

  .header-model-2-icons .search-form input:focus,
  .header-model-2-icons .search-form input:active,
  .header-model-2-icons .search-form button:focus,
  .header-model-2-icons .search-form button:active {
    outline: none !important;
    box-shadow: none !important;
    background: none !important;
    border: 2px solid #f0e8f3 !important;
  }

  .header-model-2-icons .user-dropdown a:focus,
  .header-model-2-icons .user-dropdown a:active,
  .header-model-2-icons .user-dropdown a:focus-visible {
    outline: none !important;
    box-shadow: none !important;
    background: none !important;
    border: none !important;
  }
</style>

<ul class="header-model-2-icons">

  <!-- Search Icon -->
  <li class="search-toggle">
    <a href="#" class="header-icon-btn" id="searchToggle"
       title="{{ 'general.search.title' | t | default: 'Search' }}"
       aria-label="{{ 'general.search.title' | t | default: 'Search' }}"
       aria-expanded="false"
       aria-controls="searchForm">
      <i class="fa fa-search" aria-hidden="true"></i>
    </a>
    <div class="search-form" id="searchForm" role="dialog" aria-labelledby="searchTitle">
      <h4 id="searchTitle">üîç –¢—ä—Ä—Å–µ—Ç–µ –ø—Ä–æ–¥—É–∫—Ç–∏</h4>
      <form action="/search" method="get" role="search">
        {% if settings.show_search_prt %}
        <input type="hidden" name="type" value="product">
        {% endif %}
        <div class="search-input-wrapper">
          <i class="fa fa-search search-icon" aria-hidden="true"></i>
          <input type="search"
                 name="q"
                 value="{{ search.terms | escape }}"
                 placeholder="–¢—ä—Ä—Å–µ–Ω–µ..."
                 aria-label="–¢—ä—Ä—Å–µ–Ω–µ –Ω–∞ –ø—Ä–æ–¥—É–∫—Ç–∏"
                 autocomplete="off">
          <button type="submit">
            –¢–™–†–°–ò
          </button>
        </div>
      </form>
    </div>
  </li>

  <!-- Wishlist Icon -->
  {% if settings.enable_wishlist %}
  <li class="wishlist-toggle">
    <a href="/pages/wishlist" class="header-icon-btn"
       title="{{ 'products.wishlist.wishlist_name' | t | default: 'Wishlist' }}"
       aria-label="{{ 'products.wishlist.wishlist_name' | t | default: 'Wishlist' }}">
      <i class="fa fa-heart-o" aria-hidden="true"></i>
    </a>
  </li>
  {% endif %}

  <!-- User Account Icon -->
  <li class="user-toggle">
    {% if shop.customer_accounts_enabled %}
      {% if customer %}
        <a href="#" class="header-icon-btn" id="userToggle"
           title="{{ 'layout.customer.account' | t | default: 'Account' }}"
           aria-label="{{ 'layout.customer.account' | t | default: 'Account' }}"
           aria-expanded="false"
           aria-controls="userDropdown">
          <i class="fa fa-user" aria-hidden="true"></i>
        </a>
        <div class="user-dropdown" id="userDropdown" role="menu" aria-labelledby="userToggle">
          <button type="button" class="close-dropdown" id="closeUserDropdown"
                  aria-label="{{ 'general.accessibility.close' | t | default: 'Close' }}">
            <i class="fa fa-times" aria-hidden="true"></i>
          </button>
          <ul>
            <li>
              <a href="/account" role="menuitem">
                <i class="fa fa-user" aria-hidden="true"></i>
                {{ 'layout.customer.account' | t | default: 'Account' }}
              </a>
            </li>
            <li>
              <a href="/account/addresses" role="menuitem">
                <i class="fa fa-address-book-o" aria-hidden="true"></i>
                {{ 'customer.addresses.title' | t | default: 'Addresses' }}
              </a>
            </li>
            {% if settings.enable_wishlist %}
            <li>
              <a href="/pages/wishlist" role="menuitem">
                <i class="fa fa-heart" aria-hidden="true"></i>
                {{ 'products.wishlist.wishlist_name' | t | default: 'Wishlist' }}
              </a>
            </li>
            {% endif %}
            <li>
              {{ 'layout.customer.log_out' | t | customer_logout_link | replace: '<a', '<a role="menuitem"' | replace: '<a role="menuitem"', '<a role="menuitem" class="logout-link"' | replace: '>', '><i class="fa fa-sign-out" aria-hidden="true"></i>' }}
            </li>
          </ul>
        </div>
      {% else %}
        <a href="/account/login" class="header-icon-btn"
           title="{{ 'layout.customer.log_in' | t | default: 'Log in' }}"
           aria-label="{{ 'layout.customer.log_in' | t | default: 'Log in' }}">
          <i class="fa fa-sign-in" aria-hidden="true"></i>
        </a>
      {% endif %}
    {% else %}
      <a href="#" class="header-icon-btn"
         title="{{ 'layout.customer.account' | t | default: 'Account' }}"
         onclick="alert('{{ 'layout.customer.account_disabled' | t | default: 'Customer accounts are disabled' }}'); return false;"
         aria-label="{{ 'layout.customer.account' | t | default: 'Account' }}">
        <i class="fa fa-user" aria-hidden="true"></i>
      </a>
    {% endif %}
  </li>

  <!-- Cart Icon -->
  <li class="cart-toggle">
    <a href="/cart" class="header-icon-btn"
       title="{{ 'cart.general.title' | t | default: 'Cart' }}"
       aria-label="{{ 'cart.general.title' | t | default: 'Cart' }} {% if cart.item_count > 0 %}({{ cart.item_count }} {{ 'cart.general.item' | t: count: cart.item_count }}){% endif %}">
      <i class="fa fa-shopping-cart" aria-hidden="true"></i>
      {% if cart.item_count > 0 %}
        <span class="cart-count" id="cartCounter" aria-hidden="true">{{ cart.item_count }}</span>
      {% endif %}
    </a>
  </li>

</ul>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    // Enhanced search toggle functionality
    const searchToggle = document.getElementById('searchToggle');
    const searchForm = document.getElementById('searchForm');
    const closeSearch = document.getElementById('closeSearch');
    const isMobile = () => window.innerWidth <= 767;

    if (searchToggle && searchForm) {
      function openSearch() {
        searchForm.classList.add('active');
        searchToggle.setAttribute('aria-expanded', 'true');

        // Focus management
        const searchInput = searchForm.querySelector('input[type="search"]');
        if (searchInput) {
          setTimeout(() => {
            searchInput.focus();
            searchInput.select();
          }, 100);
        }

        // Prevent body scroll on mobile
        if (isMobile()) {
          document.body.style.overflow = 'hidden';
        }

        // Trap focus for accessibility
        trapFocus(searchForm);
      }

      function closeSearchForm() {
        searchForm.classList.remove('active');
        searchToggle.setAttribute('aria-expanded', 'false');
        document.body.style.overflow = '';
        searchToggle.focus();
      }

      searchToggle.addEventListener('click', function(e) {
        e.preventDefault();
        const isActive = searchForm.classList.contains('active');

        if (isActive) {
          closeSearchForm();
        } else {
          openSearch();
        }
      });

      // Close button functionality
      if (closeSearch) {
        closeSearch.addEventListener('click', function(e) {
          e.preventDefault();
          closeSearchForm();
        });
      }

      // Close search form when clicking outside (desktop only)
      document.addEventListener('click', function(e) {
        if (!isMobile() &&
            !searchToggle.contains(e.target) &&
            !searchForm.contains(e.target) &&
            searchForm.classList.contains('active')) {
          closeSearchForm();
        }
      });

      // Close search on mobile backdrop click
      if (isMobile()) {
        searchForm.addEventListener('click', function(e) {
          if (e.target === searchForm) {
            closeSearchForm();
          }
        });
      }

      // Keyboard navigation
      searchForm.addEventListener('keydown', function(e) {
        if (e.key === 'Escape') {
          closeSearchForm();
        }
      });
    }

    // Enhanced user dropdown functionality
    const userToggle = document.getElementById('userToggle');
    const userDropdown = document.getElementById('userDropdown');
    const closeUserDropdown = document.getElementById('closeUserDropdown');

    if (userToggle && userDropdown) {
      function openUserDropdown() {
        userDropdown.classList.add('active');
        userToggle.setAttribute('aria-expanded', 'true');

        // Prevent body scroll on mobile
        if (isMobile()) {
          document.body.style.overflow = 'hidden';
        }

        // Trap focus for accessibility
        trapFocus(userDropdown);
      }

      function closeUserDropdownFunc() {
        userDropdown.classList.remove('active');
        userToggle.setAttribute('aria-expanded', 'false');
        document.body.style.overflow = '';
        userToggle.focus();
      }

      userToggle.addEventListener('click', function(e) {
        e.preventDefault();
        const isActive = userDropdown.classList.contains('active');

        if (isActive) {
          closeUserDropdownFunc();
        } else {
          openUserDropdown();
        }
      });

      // Close button functionality
      if (closeUserDropdown) {
        closeUserDropdown.addEventListener('click', function(e) {
          e.preventDefault();
          closeUserDropdownFunc();
        });
      }

      // Close user dropdown when clicking outside (desktop only)
      document.addEventListener('click', function(e) {
        if (!isMobile() &&
            !userToggle.contains(e.target) &&
            !userDropdown.contains(e.target) &&
            userDropdown.classList.contains('active')) {
          closeUserDropdownFunc();
        }
      });

      // Close dropdown on mobile backdrop click
      if (isMobile()) {
        userDropdown.addEventListener('click', function(e) {
          if (e.target === userDropdown) {
            closeUserDropdownFunc();
          }
        });
      }

      // Keyboard navigation
      userDropdown.addEventListener('keydown', function(e) {
        if (e.key === 'Escape') {
          closeUserDropdownFunc();
        }
      });
    }

    // Handle window resize
    let resizeTimeout;
    window.addEventListener('resize', function() {
      clearTimeout(resizeTimeout);
      resizeTimeout = setTimeout(function() {
        const nowMobile = isMobile();
        if (!nowMobile) {
          // Restore body scroll when switching to desktop
          document.body.style.overflow = '';
          if (searchForm) searchForm.classList.remove('active');
          if (userDropdown) userDropdown.classList.remove('active');
        }
      }, 250);
    });

    // Cart counter update functionality
    function updateCartCounter() {
      fetch('/cart.js')
        .then(response => response.json())
        .then(cart => {
          const counter = document.getElementById('cartCounter');
          const cartLink = document.querySelector('.cart-toggle .header-icon-btn');

          if (cart.item_count > 0) {
            if (counter) {
              counter.textContent = cart.item_count;
            } else {
              // Create counter if it doesn't exist
              const newCounter = document.createElement('span');
              newCounter.className = 'cart-count';
              newCounter.id = 'cartCounter';
              newCounter.textContent = cart.item_count;
              newCounter.setAttribute('aria-hidden', 'true');
              cartLink.appendChild(newCounter);
            }

            // Update aria-label
            cartLink.setAttribute('aria-label',
              `{{ 'cart.general.title' | t | default: 'Cart' }} (${cart.item_count} ${cart.item_count === 1 ? '{{ "cart.general.item" | t | default: "item" }}' : '{{ "cart.general.items" | t | default: "items" }}'})`
            );
          } else {
            if (counter) {
              counter.remove();
            }
            cartLink.setAttribute('aria-label', '{{ 'cart.general.title' | t | default: 'Cart' }}');
          }
        })
        .catch(error => console.log('Cart update error:', error));
    }

    // Listen for cart updates
    document.addEventListener('cart:updated', updateCartCounter);

    // Check cart on page load
    updateCartCounter();

    // Focus trap utility function
    function trapFocus(element) {
      const focusableElements = element.querySelectorAll(
        'button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])'
      );
      const firstElement = focusableElements[0];
      const lastElement = focusableElements[focusableElements.length - 1];

      function handleTabKey(e) {
        if (e.key === 'Tab') {
          if (e.shiftKey) {
            if (document.activeElement === firstElement) {
              e.preventDefault();
              lastElement.focus();
            }
          } else {
            if (document.activeElement === lastElement) {
              e.preventDefault();
              firstElement.focus();
            }
          }
        }
      }

      element.addEventListener('keydown', handleTabKey);

      // Focus first element
      if (firstElement) {
        firstElement.focus();
      }

      // Return cleanup function
      return function() {
        element.removeEventListener('keydown', handleTabKey);
      };
    }

    // Global keyboard navigation
    document.addEventListener('keydown', function(e) {
      if (e.key === 'Escape') {
        // Close any open dropdowns/modals
        if (searchForm && searchForm.classList.contains('active')) {
          searchForm.classList.remove('active');
          searchToggle.setAttribute('aria-expanded', 'false');
          document.body.style.overflow = '';
          searchToggle.focus();
        }
        if (userDropdown && userDropdown.classList.contains('active')) {
          userDropdown.classList.remove('active');
          userToggle.setAttribute('aria-expanded', 'false');
          document.body.style.overflow = '';
          userToggle.focus();
        }
      }
    });
  });
</script>

{% schema %}
{
  "name": "Header Model 2",
  "settings": [
    {
      "type": "header",
      "content": "Icon Settings"
    },
    {
      "type": "text",
      "id": "icon_size",
      "label": "Icon Size",
      "default": "44px",
      "info": "Size of header action icons"
    },
    {
      "type": "text",
      "id": "icon_font_size",
      "label": "Icon Font Size",
      "default": "16px",
      "info": "Font size of icons within buttons"
    },
    {
      "type": "text",
      "id": "icon_spacing",
      "label": "Icon Spacing",
      "default": "16px",
      "info": "Space between header icons"
    },
    {
      "type": "text",
      "id": "icon_border_radius",
      "label": "Icon Border Radius",
      "default": "50%",
      "info": "Border radius for icon buttons (50% for circle)"
    },
    {
      "type": "color",
      "id": "icon_bg_color",
      "label": "Icon Background",
      "default": "#f8f4f9"
    },
    {
      "type": "color",
      "id": "icon_color",
      "label": "Icon Color",
      "default": "#7b6b8a"
    },
    {
      "type": "text",
      "id": "icon_border",
      "label": "Icon Border",
      "default": "2px solid #e8e1ec",
      "info": "CSS border property for icons"
    },
    {
      "type": "color",
      "id": "icon_hover_bg",
      "label": "Icon Hover Background",
      "default": "#ffeef0"
    },
    {
      "type": "color",
      "id": "icon_hover_color",
      "label": "Icon Hover Color",
      "default": "#ff6b9d"
    },
    {
      "type": "header",
      "content": "Search Settings"
    },
    {
      "type": "color",
      "id": "search_btn_bg",
      "label": "Search Button Background",
      "default": "#ff6b9d"
    },
    {
      "type": "color",
      "id": "search_btn_bg2",
      "label": "Search Button Background Gradient",
      "default": "#ffa8cc"
    },
    {
      "type": "color",
      "id": "search_btn_color",
      "label": "Search Button Text Color",
      "default": "#ffffff"
    },
    {
      "type": "color",
      "id": "search_btn_hover_bg",
      "label": "Search Button Hover Background",
      "default": "#ff4d8a"
    },
    {
      "type": "color",
      "id": "search_btn_hover_bg2",
      "label": "Search Button Hover Background Gradient",
      "default": "#ff87b3"
    },
    {
      "type": "header",
      "content": "Cart Settings"
    },
    {
      "type": "color",
      "id": "cart_count_bg",
      "label": "Cart Count Background",
      "default": "#ff6b9d"
    },
    {
      "type": "color",
      "id": "cart_count_bg2",
      "label": "Cart Count Background Gradient",
      "default": "#ffa8cc"
    },
    {
      "type": "color",
      "id": "cart_count_color",
      "label": "Cart Count Text Color",
      "default": "#ffffff"
    }
  ]
}
{% endschema %}
